<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or "Honig vom Imker" }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <!-- HEADER -->
  <header class="nav">
    <div class="container nav-inner">
      <!-- Logo -->
      <a class="brand" href="#home" aria-label="Zur Startseite">
        <img src="{{ url_for('static', filename='img/honeypot.png') }}" alt="" class="logo-img">
      </a>

      <button id="menuBtn" class="menu-btn" aria-label="MenÃ¼ Ã¶ffnen" aria-controls="menuPanel" aria-expanded="false">MenÃ¼</button>
    </div>
  </header>

  <!-- MENÃœOVERLAY -->
  <aside id="menuPanel" class="menu-panel" aria-hidden="true">
    <nav class="menu-nav">
      <a href="#home" class="menu-link">Start</a>
      <a href="#infoAK" class="menu-link">Ãœber mich</a>
      <a href="#infoMap" class="menu-link">Meine Bienen</a>
      <a href="#process" class="menu-link">Prozess</a>
      <a href="#order" class="menu-link">Bestellen</a>
    </nav>
  </aside>

  <!-- BEE-LAYER -->
  <div id="bee-layer" data-bee-src="{{ url_for('static', filename='img/bee.png') }}"></div>

  <!-- CONTENT -->
  <main class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash">
          {% for category, message in messages %}
            <div class="flash-item {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">
      <small>&copy; {{ 2025 }} Imkerei Â· Regional Â· NatÃ¼rlich</small>
    </div>
  </footer>

  <!-- MENÃœ LOGIK -->
  <script>
    (function () {
      const btn = document.getElementById('menuBtn');
      const panel = document.getElementById('menuPanel');
      const openMenu = () => { panel.classList.add('open'); btn.setAttribute('aria-expanded','true'); panel.setAttribute('aria-hidden','false'); }
      const closeMenu = () => { panel.classList.remove('open'); btn.setAttribute('aria-expanded','false'); panel.setAttribute('aria-hidden','true'); }
      btn.addEventListener('click', () => panel.classList.contains('open') ? closeMenu() : openMenu());
      panel.addEventListener('click', (e) => { if (e.target.classList.contains('menu-link') || e.target === panel) closeMenu(); });
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeMenu(); });
    })();
  </script>

  <!-- Bienen -->
  <script src="{{ url_for('static', filename='bees.js') }}"></script>

  <!-- ðŸŒ„ Parallax-Hintergrund (streifenfrei via ::before) -->
  <script>
    (function(){
      const factor = -0.05;  // Bewegung entgegen der Scrollrichtung
      const smooth = 0.1;    // weiches Nachziehen
      let target = 0, current = 0;

      function onScroll() {
        target = window.scrollY * factor;
      }
      window.addEventListener("scroll", onScroll, {passive:true});
      onScroll();

      function raf() {
        current += (target - current) * smooth;
        // setzt die Y-Verschiebung fÃ¼r body::before
        document.documentElement.style.setProperty('--bg-shift', current.toFixed(1) + 'px');
        requestAnimationFrame(raf);
      }
      raf();

      window.addEventListener("resize", onScroll);
    })();
  </script>

  <!-- ðŸ”¹ Hotspot-MenÃ¼s: Hover/Click/ARIA -->
  <script>
    (function(){
      const hotspots = document.querySelectorAll('.hotspot .dot');

      function closeAll(except){
        document.querySelectorAll('.hotspot .dot[aria-expanded="true"]').forEach(btn=>{
          if(btn!==except){ btn.setAttribute('aria-expanded','false'); }
        });
      }

      hotspots.forEach(btn=>{
        // Ã–ffnen per Klick/Touch
        btn.addEventListener('click', (e)=>{
          const isOpen = btn.getAttribute('aria-expanded') === 'true';
          closeAll(btn);
          btn.setAttribute('aria-expanded', String(!isOpen));
          e.stopPropagation();
        });

        // Hover setzt aria-expanded (fÃ¼r Maus)
        btn.addEventListener('mouseenter', ()=>btn.setAttribute('aria-expanded','true'));
        btn.addEventListener('mouseleave', ()=>btn.setAttribute('aria-expanded','false'));
      });

      // Klick auÃŸerhalb: alles schlieÃŸen
      document.addEventListener('click', (e)=>{
        if(!e.target.closest('.hotspot')) closeAll();
      });
    })();
  </script>
</body>
</html>
